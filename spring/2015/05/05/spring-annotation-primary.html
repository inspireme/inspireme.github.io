<!DOCTYPE html>
<html id="J-html" class="">
<head>
    <meta charset="UTF-8" />
    <title>
        
            Spring注解@Primary
        
    </title>
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="whisper" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" media="all" href="http://localhost:4000/static/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="http://localhost:4000/static/syntax.css" />
    <!--[if lt IE 9]>
    <script src="http://localhost:4000/static/js/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script src="http://localhost:4000/static/js/jquery.js" type="text/javascript"></script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
    <nav class="lotus-nav">
        <ul>
            
            
            
            
            
            <li class="home ">
                <a href="/index.html" rel="bookmark" title="Home">
                    <i class="icon-home"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/categories.html" rel="bookmark" title="Categories">
                    <i class="icon-list-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/archives.html" rel="bookmark" title="Archives">
                    <i class="icon-reorder"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/about.html" rel="bookmark" title="About Me">
                    <i class="icon-user"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="mailto:cndone@gmail.com" rel="bookmark" title="Contact Me">
                    <i class="icon-envelope-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="https://github.com/inspireme" rel="bookmark" title="Github">
                    <i class="icon-github"></i>
                </a>
                
            </li>
            
        </ul>
    </nav>

    <p class="lotus-breadcrub">
    <a href="http://localhost:4000/index.html" rel="nofollow" rel="nofollow" title="ホームページ">Home</a>
    <span> &gt; </span>
    <a href="http://localhost:4000/archives.html" rel="nofollow" >Archives</a>
    <span> &gt; </span>
    Spring注解@Primary
</p>
<h1 class="lotus-pagetit">Spring注解@Primary</h1>

<p class="lotus-meta">Publish: <time class="date" pubdate="May  5, 2015">May  5, 2015</time></p>

<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>假定，有如下两个类，OperaSinger and MetalSinger。</p>

<h3 id="metalsinger">MetalSinger类</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetalSinger</span> <span class="kd">implements</span> <span class="n">Singer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(</span><span class="n">String</span> <span class="n">lyrics</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"I am singing with DIO voice: "</span><span class="o">+</span><span class="n">lyrics</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="operasinger">OperaSinger类</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OperaSinger</span> <span class="kd">implements</span> <span class="n">Singer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(</span><span class="n">String</span> <span class="n">lyrics</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"I am singing in Bocelli voice: "</span><span class="o">+</span><span class="n">lyrics</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="singer">Singer接口</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Singer</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">sing</span><span class="o">(</span><span class="n">String</span> <span class="n">lyrics</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>现在定义SingerService并且注入Singer</p>

<h3 id="singerservice">SingerService类</h3>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingerService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SingerService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Singer</span> <span class="n">singer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">singer</span><span class="o">.</span><span class="na">sing</span><span class="o">(</span><span class="s">"song lyrics"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>你觉得哪个Singer实现类会被注入？结果如下：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">I</span> <span class="n">am</span> <span class="n">singing</span> <span class="n">with</span> <span class="n">DIO</span> <span class="nl">voice:</span> <span class="n">song</span> <span class="n">lyrics</span></code></pre></figure>

<p>这是因为OperaSinger类未定义@Component或者@Service注解，所以Spring对于OperaSinger类完全没想法，现在加上@Component注解：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OperaSinger</span> <span class="kd">implements</span> <span class="n">Singer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(</span><span class="n">String</span> <span class="n">lyrics</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"I am singing in Bocelli voice: "</span><span class="o">+</span><span class="n">lyrics</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>然后，会得到异常信息:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">beans</span><span class="o">.</span><span class="na">factory</span><span class="o">.</span><span class="na">NoUniqueBeanDefinitionException</span><span class="o">:</span> <span class="n">No</span> <span class="n">qualifying</span> <span class="n">bean</span> <span class="n">of</span> <span class="n">type</span> <span class="o">[</span><span class="n">main</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">Singer</span><span class="o">]</span> <span class="n">is</span> 
<span class="nl">defined:</span> <span class="n">expected</span> <span class="n">single</span> <span class="n">matching</span> <span class="n">bean</span> <span class="n">but</span> <span class="n">found</span> <span class="mi">2</span><span class="o">:</span> <span class="n">metalSinger</span><span class="o">,</span><span class="n">operaSinger</span></code></pre></figure>

<p>原因显而易见，如果有不止一个bean的相同类型，并且使用了@Autowired注解根据类型绑定bean，就会得到这个异常信息，Spring不知道如何去选择。
现在给OperaSinger类加上@Primary注解。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Primary</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OperaSinger</span> <span class="kd">implements</span> <span class="n">Singer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(</span><span class="n">String</span> <span class="n">lyrics</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"I am singing in Bocelli voice: "</span><span class="o">+</span><span class="n">lyrics</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>结果如下：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">I</span> <span class="n">am</span> <span class="n">singing</span> <span class="n">in</span> <span class="n">Bocelli</span> <span class="nl">voice:</span> <span class="n">song</span> <span class="n">lyrics</span></code></pre></figure>

<p>这是因为OperaSinger类加上了@Primary注解，Primary主要的，从单词意思就可以理解。
另外解决方法是，使用@Qualifier注解使用value属性指定bean的名称。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingerService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SingerService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"operaSinger"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Singer</span> <span class="n">singer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sing</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">singer</span><span class="o">.</span><span class="na">sing</span><span class="o">(</span><span class="s">"song lyrics"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>原创文章转载请注明出处: <a href="http://9leg.com/spring/2015/05/05/spring-annotation-primary.html">Spring注解@Primary</a></p>

<p><a href="http://www.javacodegeeks.com/2015/04/spring-annotations-i-never-had-the-chance-to-use-part-1-primary.html" target="_blank">英文原文链接</a></p>

</article>
	
<p class="lotus-anno">Disclaimer: This article is based on  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="表示-非営利-継承">BY-NC-SA</a> license. Reproduced please specify switched from: <a href="" title="" rel="nofollow">whisper</a></p>
    
<section class="lotus-nextpage fn-clear">
    
    <div class="lotus-nextpage-left"><a class="prev" href="/spring/2015/02/12/spring-propertysource-value-annotations-example.html" rel="prev">&laquo;&nbsp;Spring的@PropertySource和@Value注解例子</a></div>
    
    
    <div class="lotus-nextpage-right"><a class="next" href="/java/2015/05/07/string-recursive.html" rel="next">String中的无意识递归&nbsp;&raquo;</a></div>
    
</section>


<footer class="lotus-footer">
	<p>Copyright © 2011–2016 whisper All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
<script src="http://localhost:4000/static/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="http://localhost:4000/static/js/iLotus.js" type="text/javascript"></script>
</body>
</html>
