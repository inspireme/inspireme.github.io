<!DOCTYPE html>
<html id="J-html" class="">
<head>
    <meta charset="UTF-8" />
    <title>
        
            SharedPreference.Editor中commit和apply区别
        
    </title>
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="whisper" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" media="all" href="https://inspireme.github.io/static/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="https://inspireme.github.io/static/syntax.css" />
    <!--[if lt IE 9]>
    <script src="https://inspireme.github.io/static/js/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script src="https://inspireme.github.io/static/js/jquery.js" type="text/javascript"></script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
    <nav class="lotus-nav">
        <ul>
            
            
            
            
            
            <li class="home ">
                <a href="/index.html" rel="bookmark" title="Home">
                    <i class="icon-home"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/categories.html" rel="bookmark" title="Categories">
                    <i class="icon-list-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/archives.html" rel="bookmark" title="Archives">
                    <i class="icon-reorder"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/about.html" rel="bookmark" title="About Me">
                    <i class="icon-user"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="mailto:cndone@gmail.com" rel="bookmark" title="Contact Me">
                    <i class="icon-envelope-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="https://github.com/inspireme" rel="bookmark" title="Github">
                    <i class="icon-github"></i>
                </a>
                
            </li>
            
        </ul>
    </nav>

    <p class="lotus-breadcrub">
    <a href="https://inspireme.github.io/index.html" rel="nofollow" rel="nofollow" title="ホームページ">Home</a>
    <span> &gt; </span>
    <a href="https://inspireme.github.io/archives.html" rel="nofollow" >Archives</a>
    <span> &gt; </span>
    SharedPreference.Editor中commit和apply区别
</p>
<h1 class="lotus-pagetit">SharedPreference.Editor中commit和apply区别</h1>

<p class="lotus-meta">Publish: <time class="date" pubdate="July 12, 2015">July 12, 2015</time></p>

<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>学Android也有段时间了,至今还没写过文章,可能是我懒吧(其实就是懒- -),今天在练习项目的时候，被IDEA一个warning弄懵了,看下图:</p>

<p><img src="/images/posts/SharedPreference-Editor-commit-warning.jpg" alt="commit-warning" /></p>

<p>首先<em>commit()</em>方法是为SharedPreference保存数据用的,IDEA警告意思是说,建议用<em>apply()</em>方法代替。<em>commit()</em>方法保存数据是马上执行的,而<em>apply()</em>方法会在后台执行。</p>

<p>这是毛意思呢? 反正我先注释了<em>commit()</em>方法,添加了<em>apply()</em>方法,警告信息就没有了,why? why? why?，这是为什么?</p>

<p>然后google大法搜索了下,这两个方法区别是这样的:</p>

<ul>
  <li>commit方法有boolean返回值,表示保存是否成功的.</li>
  <li>apply方法是void的.</li>
  <li>commit方法是同步执行保存.</li>
  <li>apply方法是异步执行保存(这就是IDEA的警告意思吧).</li>
</ul>

<p><strong>应该到底用哪个方法呢? 我的结论是视实际情况而定,如不关心是否保存成功,就可以用异步的apply方法,相反,在乎保存返回值的,则用commit方法.如果出现并发情况,那么肯定是用异步的apply方法,这是如果用了commit方法的话，就有可能会导致阻塞.
apply方法是现将数据立马存到内存中,然后会异步的去保存到目录文件去.</strong></p>

<p>抄一段API文档中的说明:</p>

<p>Unlike commit(), which writes its preferences out to persistent storage synchronously, apply() commits its changes to the in-memory SharedPreferences immediately but starts an asynchronous commit to disk and you won’t be notified of any failures. If another editor on this SharedPreferences does a regular commit() while a apply() is still outstanding, the commit() will block until all async commits are completed as well as the commit itself.</p>

<p>As SharedPreferences instances are singletons within a process, it’s safe to replace any instance of commit() with apply() if you were already ignoring the return value.</p>

<p><a href="http://developer.android.com/intl/zh-cn/reference/android/content/SharedPreferences.Editor.html#apply()" target="_blank">官方API-apply()方法解释(需翻墙)</a></p>

<p>在获取SharedPreferences对象时,大家会用那种方式呢?</p>

<ul>
  <li>Activity.getPreferences(int mode)</li>
  <li>PreferenceManager.getDefaultSharedPreferences(Context context);</li>
  <li>ContextWrapper.getSharedPreferences(String name, int mode)</li>
</ul>

<p>然并卵,1和2其实还是调用的第三个方法,如下:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">SharedPreferences</span> <span class="nf">getPreferences</span><span class="o">(</span><span class="kt">int</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">return</span> <span class="nf">getSharedPreferences</span><span class="o">(</span><span class="n">getLocalClassName</span><span class="o">(),</span> <span class="n">mode</span><span class="o">);</span>
<span class="o">}</span>
    </code></pre></figure>

<p>Activity的方法,调用的还是父类的<em>getSharedPreferences</em>方法,就是第三个方法，只不过这里保存文件的文件名称,使用默认的类名罢了.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">SharedPreferences</span> <span class="nf">getDefaultSharedPreferences</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getSharedPreferences</span><span class="o">(</span><span class="n">getDefaultSharedPreferencesName</span><span class="o">(</span><span class="n">context</span><span class="o">),</span>
                <span class="n">getDefaultSharedPreferencesMode</span><span class="o">());</span>
<span class="o">}</span>
   
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getDefaultSharedPreferencesName</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="na">getPackageName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"_preferences"</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">getDefaultSharedPreferencesMode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>第二种,在明显不过了,tmd还是调用第三个啊,文件名称和操作模式mode都有默认值。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">SharedPreferences</span> <span class="nf">getSharedPreferences</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mBase</span><span class="o">.</span><span class="na">getSharedPreferences</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">mode</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>这是祖宗,自定义文件名称,操作模式可选,完美.</p>

<p>原创文章转载请注明出处：<a href="http://9leg.com/android/2015/07/12/whats-the-difference-between-commit-and-apply-in-shared-preference.html">SharedPreference.Editor中commit和apply区别</a></p>

</article>
	
<p class="lotus-anno">Disclaimer: This article is based on  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="表示-非営利-継承">BY-NC-SA</a> license. Reproduced please specify switched from: <a href="" title="" rel="nofollow">whisper</a></p>
    
<section class="lotus-nextpage fn-clear">
    
    <div class="lotus-nextpage-left"><a class="prev" href="/maven/2015/06/29/maven-import-local-jar-and-packing-jar.html" rel="prev">&laquo;&nbsp;Maven引入本地jar包并生成jar包运行修改MANIFEST.MF文件</a></div>
    
    
    <div class="lotus-nextpage-right"><a class="next" href="/design/2015/10/01/distributed-session.html" rel="next">大型网站之分布式会话管理&nbsp;&raquo;</a></div>
    
</section>


<footer class="lotus-footer">
	<p>Copyright © 2011–2016 whisper All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
<script src="https://inspireme.github.io/static/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="https://inspireme.github.io/static/js/iLotus.js" type="text/javascript"></script>
</body>
</html>
