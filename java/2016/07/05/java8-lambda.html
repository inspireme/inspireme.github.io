<!DOCTYPE html>
<html id="J-html" class="">
<head>
    <meta charset="UTF-8" />
    <title>
        
            Javaラムダ式            
        
        (whisper's Programming MemoPage)
    </title>
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="whisper" />
    <meta name="description" content="Javaのラムダ式について。" />
    <meta name="keywords" content="java8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" media="all" href="https://inspireme.github.io/static/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="https://inspireme.github.io/static/syntax.css" />
    <!--[if lt IE 9]>
    <script src="https://inspireme.github.io/static/js/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script src="https://inspireme.github.io/static/js/jquery.js" type="text/javascript"></script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
    <nav class="lotus-nav">
        <ul>
            
            
            
            
            
            <li class="home ">
                <a href="/index.html" rel="bookmark" title="Home">
                    <i class="icon-home"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/categories.html" rel="bookmark" title="Categories">
                    <i class="icon-list-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/archives.html" rel="bookmark" title="Archives">
                    <i class="icon-reorder"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/about.html" rel="bookmark" title="About Me">
                    <i class="icon-user"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="mailto:cndone@gmail.com" rel="bookmark" title="Contact Me">
                    <i class="icon-envelope-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="https://github.com/inspireme" rel="bookmark" title="Github">
                    <i class="icon-github"></i>
                </a>
                
            </li>
            
        </ul>
    </nav>

    <p class="lotus-breadcrub">
    <a href="https://inspireme.github.io/index.html" rel="nofollow" rel="nofollow" title="ホームページ">Home</a>
    <span> &gt; </span>
    <a href="https://inspireme.github.io/archives.html" rel="nofollow" >Archives</a>
    <span> &gt; </span>
    Javaラムダ式
</p>
<h1 class="lotus-pagetit">Javaラムダ式</h1>

<p class="lotus-meta">Publish: <time class="date" pubdate="July  5, 2016">July  5, 2016</time></p>

<article  itemscope itemtype="http://schema.org/Article" class="lotus-post lotus-post-columns-1">
<p>ラムダ式は、JDK1.8で導入された構文。
関数型インターフェース（抽象メソッドが1つだけ定義されているインターフェース）の変数に代入する箇所ではラムダ式を渡すことが出来る。<br />
※インタフェースには一つだけのメソッドといっても、defalut method,static methodに限らない。0個か2個以上でしたら、実装対象のメソッドを決定できない為、
コンパイルエラーになる</p>

<ul>
  <li><a href="#1-ref">匿名クラスとラムダ式</a></li>
  <li><a href="#2-ref">ラムダ式の構文</a></li>
  <li><a href="#3-ref">スコープ</a></li>
  <li><a href="#4-ref">プリミティブ型とラッパークラスの注意点</a></li>
  <li><a href="#5-ref">キャスト</a></li>
  <li><a href="#6-ref">シリアライズ</a></li>
</ul>

<h4> <p id="1-ref">匿名クラスとラムダ式</p></h4>
<hr />

<p>見た目上は、匿名クラスを短く実装するような気がする。ラムダ式の代入先である関数型インターフェイスには抽象メソッドが一つのみであるため、
 ラムダ式がどのメソッドを実装するのかは選択の余地なく決まる。</p>
<table>
    <thead>
        <tr>
            <th>匿名クラス</th>
            <th>ラムダ式</th>
        </tr>
    </thead>
    <tbody>
     <tr>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
 <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"new thread "</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">};</span></code></pre></figure>

</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"new thread "</span><span class="o">);</span></code></pre></figure>

 </td>
     </tr>
     <tr>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Integer</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

</td>
<td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">,</span> <span class="n">o2</span><span class="o">));</span></code></pre></figure>

</td>
     </tr>
	</tbody>	
</table>

<h4> <p id="2-ref">ラムダ式の構文</p></h4>
<hr />

<ul>
  <li>引数</li>
</ul>
<table>
    <thead>
        <tr>
            <th>定義方法</th>
            <th>ラムダ式の例</th>
        </tr>
    </thead>
    <tbody>
     <tr>
          <td>
型を明確に示す
</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{}</span>
<span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{}</span>
<span class="o">(</span><span class="kt">int</span> <span class="n">n1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{}</span></code></pre></figure>

 </td>
     </tr>
     <tr>
          <td>
型を省く
</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{}</span>
<span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{}</span>
<span class="o">(</span><span class="n">n1</span><span class="o">,</span> <span class="n">n2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{}</span>
<span class="err">×</span><span class="o">(</span><span class="n">n1</span><span class="o">,</span><span class="kt">int</span> <span class="n">n2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{}</span>  <span class="c1">//一部だけの省略はだめ。</span></code></pre></figure>

 </td>
     </tr>
     <tr>
          <td>
括弧を省く

</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">s</span> <span class="o">-&gt;</span> <span class="o">{}</span><span class="c1">//引数が一つのみでしたら、引数を囲む括弧を省くことができる。同時に型も省かないとならない</span></code></pre></figure>

 </td>
     </tr>
 	</tbody>	
</table>

<ul>
  <li>処理本体</li>
</ul>
<table>
    <thead>
        <tr>
            <th>定義方法</th>
            <th>ラムダ式の例</th>
        </tr>
    </thead>
    <tbody>
     <tr>
          <td>
基本形
</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

 </td>
     </tr>
     <tr>
          <td>
戻り値がなし
</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="n">n</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

 </td>
     </tr>
     <tr>
          <td>
括弧を省く

</td>
          <td>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="c1">//処理本体に文が一つのみでしたら、引数を囲む括弧を省くことができる。</span>
<span class="c1">//同時にreturnと末尾のセミコロン「;」も省かないとならない</span></code></pre></figure>

 </td>
     </tr>
 	</tbody>	
</table>

<h4> <p id="3-ref">スコープ</p></h4>
<hr />

<p>ラムダ式で使う変数は、ラムダ式が定義されている場所の変数とスコープが一緒になる
- 外側の変数を参照できる</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// ラムダ式の外側で定義されている変数を、ラムダ式内部から参照することが出来る。</span>
<span class="kt">void</span> <span class="nf">scope1</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// 匿名クラスの内側からも外側の変数を参照できる。（JDK1.7以前はfinal変数である必要があった)</span>
<span class="kt">void</span> <span class="nf">scope1a</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>内側再代入(変数がなんとなくfinalに定義されているような気がする)</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// その変数の値を変える（再代入する）ことは出来ない。</span>
<span class="kt">void</span> <span class="nf">scope2</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">n</span><span class="o">++;</span><span class="c1">// コンパイルエラーになる</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">scope2a</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
			<span class="n">n</span><span class="o">++;</span><span class="c1">// コンパイルエラーになる</span>
		<span class="o">}</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>外側再代入</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">scope3</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
	<span class="o">};</span>

	<span class="n">n</span><span class="o">++;</span><span class="c1">// コンパイルエラーになる</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">scope3a</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">};</span>

	<span class="n">n</span><span class="o">++;</span><span class="c1">// コンパイルエラーになる</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>変数が外側で既に定義されている</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">scope4</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">consumer</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span><span class="c1">// コンパイルエラーになる,「String</span>
												<span class="c1">// t」を「String</span>
												<span class="c1">// m」に入れ替えたら、エラーにならない</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
	<span class="o">};</span>
	<span class="n">consumer</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">scope4a</span><span class="o">()</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">123</span><span class="o">;</span>

	<span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">String</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">t</span><span class="o">);</span><span class="c1">// 匿名クラスでは別スコープになる。</span>
		<span class="o">}</span>
	<span class="o">};</span>
	<span class="n">consumer</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>this</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// 「ラムダ式を定義したメソッド」が属しているクラスのインスタンスを指す。</span>
<span class="kt">void</span> <span class="nf">scopeThis</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">);</span><span class="c1">//☞com.whisper.Test$1@548c4f57</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// thisは、匿名クラスのインスタンスを指す。</span>
<span class="kt">void</span> <span class="nf">scopeThisA</span><span class="o">()</span> <span class="o">{</span>
	<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
		<span class="nd">@Override</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">);</span><span class="c1">//☞com.whisper.Test@15db9742　匿名クラスのインスタンスを指す(new LMDExpressionScope())</span>
		<span class="o">}</span>
	<span class="o">};</span>
	<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>static</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kt">void</span> <span class="nf">scopeThisStatic</span><span class="o">()</span> <span class="o">{</span>
	  <span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
	    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">);</span><span class="c1">// コンパイルエラーになる</span>
	  <span class="o">};</span>
	  <span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">static</span> <span class="kt">void</span> <span class="nf">scopeThisStaticA</span><span class="o">()</span> <span class="o">{</span>
	  <span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
	    <span class="nd">@Override</span>
	    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
	      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">);</span><span class="c1">//匿名クラスのインスタンスを指す(new LMDExpressionScope())</span>
	    <span class="o">}</span>
	  <span class="o">};</span>
	  <span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<h4> <p id="4-ref">プリミティブ型とラッパークラスの注意点</p></h4>
<hr />

<p><mark>「関数型インターフェースのメソッドの引数の型」と「ラムダ式の引数の型」に関しては、自動変換のような事はできない。プリミティブ型（intなど）とラッパークラスう（Integerなど）は区別されている。
皮肉にメソッドの戻り値の型は自動変換できる</mark>。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LambdaScope2</span> <span class="o">{</span>

	<span class="kd">interface</span> <span class="nc">IntArgument</span> <span class="o">{</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">interface</span> <span class="nc">IntegerArgument</span> <span class="o">{</span>
		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">(</span><span class="n">Integer</span> <span class="n">n</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kt">void</span> <span class="nf">call</span><span class="o">(</span><span class="n">IntArgument</span> <span class="n">func</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">func</span><span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="n">IntArgument</span> <span class="n">test11</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
	<span class="n">IntArgument</span> <span class="n">test12</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span><span class="c1">// 引数の型が異なるのでコンパイルエラー。</span>
	<span class="n">IntArgument</span> <span class="n">test13</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span><span class="c1">// 引数の型を省略していれば問題ない。</span>

	<span class="n">IntegerArgument</span> <span class="n">test21</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span> <span class="c1">// 引数の型が異なるのでコンパイルエラー。</span>
	<span class="n">IntegerArgument</span> <span class="n">test22</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
	<span class="n">IntegerArgument</span> <span class="n">test23</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span> <span class="c1">// 引数の型を省略していれば問題ない。</span>



	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">IntArgument</span> <span class="n">test31</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
		<span class="n">LMDExpressionScope2</span> <span class="n">tester</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LMDExpressionScope2</span><span class="o">();</span>
		<span class="n">tester</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">test31</span><span class="o">);</span>
		<span class="n">IntegerArgument</span> <span class="n">test32</span> <span class="o">=</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
		<span class="n">tester</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">test32</span><span class="o">);</span>	<span class="c1">//IntArgumentとIntegerArgumentに互換性（継承関係）は無いのでコンパイルエラー。</span>
		<span class="n">tester</span><span class="o">.</span><span class="na">call</span><span class="o">((</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">));</span>
		<span class="n">tester</span><span class="o">.</span><span class="na">call</span><span class="o">((</span><span class="n">Integer</span> <span class="n">n</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">));</span>	<span class="c1">//引数の型が異なるのでコンパイルエラー。</span>
		<span class="n">tester</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">n</span><span class="o">));</span>	<span class="c1">//引数の型を省略していれば問題ない。</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h4> <p id="5-ref">キャスト</p></h4>
<hr />

<p>JDK1.8から交差型キャストという仕様が導入された。
「(インターフェース名1 &amp; インターフェース名2 &amp; …)」という形で、キャストするときに「&amp;」でインターフェース名を繋いでいく。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Runnable</span> <span class="n">object</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span>
<span class="c1">// Object object1 = () -&gt; System.out.println("abc"); // コンパイルエラー。ラムダ式がどの関数型インターフェースのものなのか分からない為。</span>
<span class="n">Object</span> <span class="n">object2</span> <span class="o">=</span> <span class="o">(</span><span class="n">Runnable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span> <span class="c1">// 関数型にキャストしたうえで、Objectクラスの変数に代入できるようになる</span>

<span class="n">Runnable</span> <span class="n">runner</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"runner-------:"</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">runner</span> <span class="k">instanceof</span> <span class="n">Runnable</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">runner</span> <span class="k">instanceof</span> <span class="n">Serializable</span><span class="o">);</span>
<span class="n">runner</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>

<span class="n">Object</span> <span class="n">object3</span> <span class="o">=</span> <span class="o">(</span><span class="n">Runnable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"object3-------:"</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object3</span> <span class="k">instanceof</span> <span class="n">Runnable</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object3</span> <span class="k">instanceof</span> <span class="n">Serializable</span><span class="o">);</span>

<span class="c1">// 交差型キャストでSerializableを指定するとSerializableが実装（合成）されている扱いになる。</span>
<span class="n">Runnable</span> <span class="n">runner3</span> <span class="o">=</span> <span class="o">(</span><span class="n">Runnable</span> <span class="o">&amp;</span> <span class="n">Serializable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">123</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"runner3------:"</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">runner3</span> <span class="k">instanceof</span> <span class="n">Runnable</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">runner3</span> <span class="k">instanceof</span> <span class="n">Serializable</span><span class="o">);</span>
<span class="n">runner3</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>

<span class="n">Object</span> <span class="n">object4</span> <span class="o">=</span> <span class="o">(</span><span class="n">Runnable</span> <span class="o">&amp;</span> <span class="n">Serializable</span> <span class="o">&amp;</span> <span class="n">Cloneable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span><span class="c1">//CloneableでもOK。</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"object4------:"</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object4</span> <span class="k">instanceof</span> <span class="n">Runnable</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object4</span> <span class="k">instanceof</span> <span class="n">Serializable</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object4</span> <span class="k">instanceof</span> <span class="n">Cloneable</span><span class="o">);</span>

<span class="c1">//結果は以下となる</span>
<span class="n">runner</span><span class="o">-------:</span>
<span class="kc">true</span>
<span class="kc">false</span>
<span class="mi">123</span>
<span class="n">object3</span><span class="o">-------:</span>
<span class="kc">true</span>
<span class="kc">false</span>
<span class="n">runner3</span><span class="o">------:</span>
<span class="kc">true</span>
<span class="kc">true</span>
<span class="mi">123</span>
<span class="n">object4</span><span class="o">------:</span>
<span class="kc">true</span>
<span class="kc">true</span>
<span class="kc">true</span>
	</code></pre></figure>

<h4> <p id="6-ref">シリアライズ</p></h4>
<hr />

<p>交差型キャストによってシリアライズを実装することは可能となります。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LambdaSerialize</span> <span class="o">{</span>

	<span class="c1">// シリアライズ</span>
	<span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
		<span class="n">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="o">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">&amp;</span> <span class="n">Serializable</span><span class="o">)</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"serialize-"</span> <span class="o">+</span> <span class="n">s</span><span class="o">;</span>

		<span class="k">try</span> <span class="o">(</span><span class="n">ByteArrayOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">())</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">(</span><span class="n">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectOutputStream</span><span class="o">(</span><span class="n">bos</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">return</span> <span class="n">bos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="c1">// デシリアライズ</span>
	<span class="kd">static</span> <span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">deserialize</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">(</span><span class="n">ByteArrayInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
				<span class="n">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectInputStream</span><span class="o">(</span><span class="n">bis</span><span class="o">))</span> <span class="o">{</span>
			<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
			<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier</span> <span class="o">=</span> <span class="o">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
			<span class="k">return</span> <span class="n">supplier</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">buf1</span> <span class="o">=</span> <span class="n">serialize</span><span class="o">(</span><span class="s">"str1"</span><span class="o">);</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">buf2</span> <span class="o">=</span> <span class="n">serialize</span><span class="o">(</span><span class="s">"str2"</span><span class="o">);</span>

		<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier1</span> <span class="o">=</span> <span class="n">deserialize</span><span class="o">(</span><span class="n">buf1</span><span class="o">);</span>
		<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">supplier2</span> <span class="o">=</span> <span class="n">deserialize</span><span class="o">(</span><span class="n">buf2</span><span class="o">);</span>

		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">supplier1</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">supplier2</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
	<span class="o">}</span>

<span class="o">}</span>

<span class="err">結果↓</span>
<span class="n">serialize</span><span class="o">-</span><span class="n">str1</span>
<span class="n">serialize</span><span class="o">-</span><span class="n">str2</span></code></pre></figure>

<ul>
  <li>関連資料：</li>
</ul>

<p><a href="http://www.tutorialspoint.com/java8/java8_streams.htm">Java8 Tutorial</a></p>


</article>
	
<p class="lotus-anno">Disclaimer: This article is based on  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="表示-非営利-継承">BY-NC-SA</a> license. Reproduced please specify switched from: <a href="" title="" rel="nofollow">whisper</a></p>
    
<section class="lotus-nextpage fn-clear">
    
    <div class="lotus-nextpage-left"><a class="prev" href="/video/2016/06/26/video.html" rel="prev">&laquo;&nbsp;動画配信に関する基礎知識</a></div>
    
    
</section>


<footer class="lotus-footer">
	<p>Copyright © 2011–2016 whisper All rights reserved. Design by <a href="http://www.zhanxin.info" target="_blank">zhanxin</a>.</p>
</footer>
<script src="https://inspireme.github.io/static/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="https://inspireme.github.io/static/js/iLotus.js" type="text/javascript"></script>
</body>
</html>
